{% load i18n static %}
<div class="related-widget-wrapper">
    {{ rendered_widget }}
    {% block links %}
    {% spaceless %}
    {% if not is_hidden %}
    {% if can_change_related %}
    <a class="related-widget-wrapper-link change-related" id="change_id_{{ name }}"
       data-href-template="{{ change_related_template_url }}?{{ url_params }}"
       title="{% blocktranslate %}Change selected {{ model }}{% endblocktranslate %}">
        <img src="{% static 'admin/img/icon-changelink.svg' %}" style="font-family: Vazir"
             alt="{% translate 'تغییر' %}">
    </a>
    {% endif %}
    {% if not can_change_related %}
    <img id="{{ name }}" src="{% static 'admin/img/icon-changelink.svg' %}" style="font-family: Vazir"
         alt="{% translate 'تغییر' %}" onClick="m2m(id);">
    <img id="{{ name }}" src="{% static 'admin/img/icon.png' %}" style="font-family: Vazir"
         alt="{% translate 'تغییر' %}" onClick="m2m_gantt(id);">
    <!--        <button type="button" id="{{ name }}" onClick="m2m(id);">asl</button>-->
    {% endif %}
    {% if can_add_related %}
    <a class="related-widget-wrapper-link add-related" id="add_id_{{ name }}"
       href="{{ add_related_url }}?{{ url_params }}"
       title="{% blocktranslate %}Add another {{ model }}{% endblocktranslate %}">
        <img src="{% static 'admin/img/icon-addlink.svg' %}" style="font-family: Vazir"
             alt="{% translate 'اضافه کردن' %}">
    </a>
    {% endif %}
    {% if can_delete_related %}
    <a class="related-widget-wrapper-link delete-related" id="delete_id_{{ name }}"
       data-href-template="{{ delete_related_template_url }}?{{ url_params }}"
       title="{% blocktranslate %}Delete selected {{ model }}{% endblocktranslate %}">
        <img src="{% static 'admin/img/icon-deletelink.svg' %}" style="font-family: Vazir"
             alt="{% translate 'پاک کردن' %}">
    </a>
    {% endif %}
    {% endif %}
    {% endspaceless %}
    {% endblock %}
</div>

<script>
    function m2m(id) {
        var full_id = "id_" + id;
        var data = document.getElementById(full_id);
        var strUser = data.options[data.selectedIndex].value;
        id = id.replace("_", "");
        id = id.toLowerCase();
        popupWindow = window.open("http://127.0.0.1:8000/admin/project_management/" + id + "/" + strUser + "/" + "change/", "_blank", "toolbar=yes,scrollbars=yes,resizable=yes,top=200,left=200,width=600,height=600");

    }


    function m2m_gantt(id) {
        // var full_id = "id_" + id;
        // var data = document.getElementById(full_id);
        // var strUser = data.options[data.selectedIndex].value;
        // id = id.replace("_", "");
        // id = id.toLowerCase();
        // popupWindow = window.open("http://127.0.0.1:8000/project_management/gantt-chart/", "_blank", "toolbar=yes,scrollbars=yes,resizable=yes,top=200,left=200,width=600,height=600");
        var mapForm = document.createElement("form");
        mapForm.target = "Map";
        mapForm.method = "POST"; // or "post" if appropriate
        mapForm.action = "http://127.0.0.1:8000/project_management/gantt-chart/";
        var mapInput = document.createElement("input");
        mapInput.type = "text";
        mapInput.name = "machinename";
        mapInput.value = id;
        mapForm.appendChild(mapInput);

        document.body.appendChild(mapForm);

        map = window.open("", "Map", "status=0,title=0,height=600,width=800,scrollbars=1");
        if (map) {
            mapForm.submit();
        } else {
            alert('You must allow popups for this map to work.');
        }
    }
</script>