{% load i18n admin_urls static admin_modify %}

<div class="js-inline-admin-formset inline-group" id="{{ inline_admin_formset.formset.prefix }}-group"
     data-inline-type="tabular"
     data-inline-formset="{{ inline_admin_formset.inline_formset_data }}">
  <div class="tabular inline-related {% if forloop.last %}last-related{% endif %}">
{{ inline_admin_formset.formset.management_form }}
<fieldset class="module {{ inline_admin_formset.classes }}" style="font-family: Vazir">
   {% if inline_admin_formset.formset.max_num == 1 %}
     <h2>{{ inline_admin_formset.opts.verbose_name|capfirst }}</h2>
   {% else %}
     <h2>{{ inline_admin_formset.opts.verbose_name_plural|capfirst }}</h2>
   {% endif %}
   {{ inline_admin_formset.formset.non_form_errors }}
   <table>
     <thead><tr>
       <th class="original"></th>
     {% for field in inline_admin_formset.fields %}

           {% if not field.widget.is_hidden %}
             <th class="column-{{ field.name }}{% if field.required %} required{% endif %}">{{ field.label|capfirst }}
             {% if field.help_text %}<img src="{% static "admin/img/icon-unknown.svg" %}" class="help help-tooltip" width="10" height="10" alt="({{ field.help_text|striptags }})" title="{{ field.help_text|striptags }}">{% endif %}
             </th>
           {% endif %}

     {% endfor %}
     {% if inline_admin_formset.formset.can_delete and inline_admin_formset.has_delete_permission %}<th style="font-family: Vazir">{% translate "پاک شود؟" %}</th>{% endif %}
     </tr></thead>

     <tbody>
     {% for inline_admin_form in inline_admin_formset %}
        {% if inline_admin_form.form.non_field_errors %}
        <tr class="row-form-errors"><td colspan="{{ inline_admin_form|cell_count }}">{{ inline_admin_form.form.non_field_errors }}</td></tr>
        {% endif %}
        <tr class="form-row {% if inline_admin_form.original or inline_admin_form.show_url %}has_original{% endif %}{% if forloop.last and inline_admin_formset.has_add_permission %} empty-form{% endif %}"
             id="{{ inline_admin_formset.formset.prefix }}-{% if not forloop.last %}{{ forloop.counter0 }}{% else %}empty{% endif %}">
        <td class="original">
          {% if inline_admin_form.original or inline_admin_form.show_url %}<p>
          {% if inline_admin_form.original %}
<!--          {{ inline_admin_form.original }}-->
          {% if inline_admin_form.model_admin.show_change_link and inline_admin_form.model_admin.has_registered_model %}<a href="{% url inline_admin_form.model_admin.opts|admin_urlname:'change' inline_admin_form.original.pk|admin_urlquote %}" class="{% if inline_admin_formset.has_change_permission %}inlinechangelink{% else %}inlineviewlink{% endif %}" style="font-family: Vazir">{% if inline_admin_formset.has_change_permission %}{% translate "تغییر" %}{% else %}{% translate "نمایش" %}{% endif %}</a>{% endif %}
          {% endif %}
          {% if inline_admin_form.show_url %}<a href="{{ inline_admin_form.absolute_url }}">{% translate "View on site" %}</a>{% endif %}
            </p>{% endif %}
          {% if inline_admin_form.needs_explicit_pk_field %}{{ inline_admin_form.pk_field.field }}{% endif %}
          {% if inline_admin_form.fk_field %}{{ inline_admin_form.fk_field.field }}{% endif %}
          {% spaceless %}
          {% for fieldset in inline_admin_form %}
            {% for line in fieldset %}
              {% for field in line %}
                {% if not field.is_readonly and field.field.is_hidden %}{{ field.field }}{% endif %}
              {% endfor %}
            {% endfor %}
          {% endfor %}
          {% endspaceless %}
        </td>

        {% for fieldset in inline_admin_form %}
          {% for line in fieldset %}
            {% for field in line %}
              {% if field.is_readonly or not field.field.is_hidden %}
              <td {% if field.field.name %}  class="field-{{ field.field.name }}"{% endif %}>
              {% if field.is_readonly %}
                  <p style="width: 200px">{{ field.contents }}</p>
              {% else %}
                  {{ field.field.errors.as_ul }}
                  {{ field.field }}
              {% endif %}
            {% if 'نام قطعه' in field.field.label %}

                  <button class="my_button" name="title" id="{{ fieldset.formset.prefix }}-{% if not forloop.parentloop.parentloop.parentloop.last %}{{ forloop.parentloop.parentloop.parentloop.counter0 }}{% else %}empty{% endif %}" type="button" onClick="fullwindowpopup(id);">جست و جوی انبار</button>
          {% endif %}
              </td>
              {% endif %}
            {% endfor %}
          {% endfor %}
        {% endfor %}
        {% if inline_admin_formset.formset.can_delete and inline_admin_formset.has_delete_permission %}
          <td class="delete">{% if inline_admin_form.original %}{{ inline_admin_form.deletion_field.field }}{% endif %}</td>
        {% endif %}
        </tr>
     {% endfor %}
     </tbody>
   </table>
    <button name="title" type="button" class="my_button" style="float: right;" onclick="print_mto()">پرینت ام تی او</button>
    <button type="button" class="my_button" style="float: right;margin-right: 10px"; onclick="print_mto_report()">گزارش ام تی او</button>
</fieldset>
  </div>
</div>
<style>
    .my_button{
        margin-top: 10px;
        width: 100px;
        height: 30px;
    background: #7CA0C7 url(../img/default-bg.gif) top left repeat-x;
    color: #fff;
        border-radius: 5px;
    }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.min.js"></script>
<script>
function paste() {
      document.execCommand("paste");
      console.log(pasteText.textContent);
}

    function print_mto(){

           var str = "id_agenda_number";
           var str2 = "id_queue";

           var y = document.getElementById(str).value;
            var mapForm = document.createElement("form");
            mapForm.target = "Map";
            mapForm.method = "POST"; // or "post" if appropriate
            mapForm.action = "http://127.0.0.1:8000/project_management/print_mto/";

            var mapInput = document.createElement("input");
            mapInput.type = "text";
            mapInput.name = "title";
            mapInput.value = y;
            mapForm.appendChild(mapInput);


            document.body.appendChild(mapForm);

            map = window.open("", "Map");

            window.onmessage = function (e) {
                document.getElementById(str).value = e.data;
                // alert(e.data);
            };
        if (map) {
            mapForm.submit();
        } else {
            alert('You must allow popups for this map to work.');
        }

    }


        function print_mto_report(){
           var str = "id_agenda_number";
           var y = document.getElementById(str).value;
            var mapForm = document.createElement("form");
            mapForm.target = "Map";
            mapForm.method = "POST"; // or "post" if appropriate
            mapForm.action = "http://127.0.0.1:8000/project_management/print_mto_report/";

            var mapInput = document.createElement("input");
            mapInput.type = "text";
            mapInput.name = "title";
            mapInput.value = y;
            mapForm.appendChild(mapInput);


            document.body.appendChild(mapForm);

            map = window.open("", "Map");

            window.onmessage = function (e) {
                document.getElementById(str).value = e.data;
                // alert(e.data);
            };
        if (map) {
            mapForm.submit();
        } else {
            alert('You must allow popups for this map to work.');
        }

    }



       function fullwindowpopup(x){
           // var str = "id_mto_content_set-" + x[x.length - 1] + "-part_name";
           var y = document.getElementById(x);
           y = y.getElementsByClassName("field-part_name")[0];
           y = y.getElementsByTagName("p")[0].innerText;

            var mapForm = document.createElement("form");
            mapForm.target = "Map";
            mapForm.method = "POST"; // or "post" if appropriate
            mapForm.action = "http://127.0.0.1:8000/project_management/inventory/";

            var mapInput = document.createElement("input");
            mapInput.type = "text";
            mapInput.name = "title";
            mapInput.value = y;
            mapForm.appendChild(mapInput);

            document.body.appendChild(mapForm);

            map = window.open("", "Map", "status=0,title=0,height=600,width=800,scrollbars=1");

            window.onmessage = function (e) {
                document.getElementById(str).value = e.data;
                // alert(e.data);
            };
        if (map) {
            mapForm.submit();
        } else {
            alert('You must allow popups for this map to work.');
        }

       }

</script>